<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>魔方</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/png" href="ico.png">
</head>
<body>
<canvas width="600" height="600"></canvas>
<div class="cube-wrapper"></div>
<script src="../../lib/3d-css.js"></script>
<script src="data.js"></script>
<script src="tools.js"></script>
<script src="cube.js"></script>
<script>
    (function () {

        /**todo
         * 还有2件事要做：
         * 1.实现点位置的记录、用canvas绘制一个酷炫的开场动画
         * 2.实现黑色挡板，美观化
         * */

        initCube();

        var point = {
            pos : [ 0 , 0 , 0 , 1 ] ,
            origin : [ 150 , 150 , -150 ]
        };
        point.matrix = _3d.eye();
        gc.fillStyle = "red";

        function drawPoint( matrix ) {
            gc.clearRect( 0 , 0 , 600 , 600 );
            point.matrix = _3d.combine( matrix , point.matrix );
            var real = _3d.origin3d( point.matrix , point.origin[ 0 ] , point.origin[ 1 ] , point.origin[ 2 ] );
            point.pos = _3d.decompose3d( real , [ 0 , 0 , 0 , 1 ] );
            gc.fillRect( 147 + point.pos[ 0 ] , 147 + point.pos[ 1 ] , 6 , 6 );
        }

        Drag( cubeWrapper , {
            onDrag : function ( dx , dy ) {
                if ( dx || dy ) {
                    var s = ( Math.abs( dx ) + Math.abs( dy )) / 3.5;
                    var t_matrix = _3d.rotate3dM( dy , -dx , 0 , s );
                    rotateCube( t_matrix );
//                    drawPoint( t_matrix )
                }
            }
        } );

        // 点击滚轮，自动撤销上次操作
        document.body.onclick = function ( e ) {
            if ( e.which == 2 ) {
                var action = Actions.pop();
                action && rotateFloorAction( action.axis , action.floorNum , 0 , -action.rotateNum )
            }
        }

    })();
</script>
</body>
</html>