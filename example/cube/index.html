<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>魔方</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" type="image/png" href="ico.png">
</head>
<body>
<canvas width="600" height="600"></canvas>
<div class="cube-wrapper"></div>
<script src="../../lib/3d-css.js"></script>
<script src="data.js"></script>
<script src="tools.js"></script>
<script src="cube.js"></script>
<script>
    (function () {

        /**todo
         * 还有2件事要做：
         * 1.实现点位置的记录、用canvas绘制一个酷炫的开场动画
         * 2.实现黑色挡板，美观化
         * */

        initCube();

        rotateCube( _3d.rotate3dM( 1 , -1 , 0 , 45 ) );

        // 随机旋转10次
        var randomAction = new Array( 10 );
        var axis = [ "x" , "y" , "z" ] , floorNums = [ 0 , 1 , 2 ];

        function randomGet( arr ) {
            return arr[ (( Math.random() * 100) << 0) % arr.length ];
        }

        loopArray( randomAction , function ( action , i ) {
            randomAction[ i ] = function ( done ) {
                rotateFloorAction( randomGet( axis ) , randomGet( floorNums ) , 0 , 1 , function ( iswin ) {
                    if ( iswin && i != randomAction.length - 1 ) {
                        document.body.classList.remove( "lock" );
                        var winBorder = querySelector( ".win-board" );
                        winBorder && winBorder.parentNode && winBorder.parentNode.removeChild( winBorder );
                    }
                    done();
                } , 300 );
            }
        } );

        serialTask( randomAction , function () {
//            alert( "开始" )
        } );

        Drag( cubeWrapper , {
            onDrag : function ( dx , dy ) {
                if ( dx || dy ) {
                    var s = ( Math.abs( dx ) + Math.abs( dy )) / 3.5;
                    var t_matrix = _3d.rotate3dM( dy , -dx , 0 , s );
                    rotateCube( t_matrix );
                }
            }
        } );

        // 点击滚轮，自动撤销上次操作
        document.body.onclick = function ( e ) {
            if ( e.which == 2 ) {
                var action = Actions.pop();
                action && rotateFloorAction( action.axis , action.floorNum , 0 , -action.rotateNum )
            }
        }

    })();
</script>
</body>
</html>